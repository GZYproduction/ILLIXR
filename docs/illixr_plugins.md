# ILLIXR plugins

## Default Plugins

- [`offline_imu_cam`][5]: Reads IMU data and images from files on disk, emulating a real sensor on the
  headset (feeds input measurements with timing similar to an actual IMU).
	- Published Topics:
		- publishes `imu_cam_type` on `imu_cam` topic

- [`ground_truth_slam`][6]: Reads the ground-truth from the same dataset to compare our output against
  (uses timing from `offline_imu_cam`).
	- Published Topics:
		- publishes `pose_type` on `true_pose` topic
	- Subscried Topics:
		- receives `imu_cam_type` on `imu_cam` topic		

- [`kimera_vio`][13]: Runs Kimera-VIO ([upstream][1]) on the input, and outputs the headset's pose. In practice, this
  publishes a fairly slow pose, so IMU integration and pose prediction is required to infer a fast pose.
	- Published Topics:
		- publishes `pose_type` on `slow_pose` topic
		- publishes `imu_integrator_input` on `imu_integrator_input` topic
	- Subscried Topics:
		- receives `imu_cam_type` on `imu_cam` topic		

- [`gtsam_integrator`][15]: Integrates over all IMU samples since the last published SLAM pose to provide a fast-pose everytime a new IMU sample.
  arrives using the GTSAM library ([upstream][14]). 
	- Published Topics:
		- publishes `imu_raw_type` on `imu_raw` topic
	- Subscried Topics:
		- receives `imu_cam_type` on `imu_cam` topic
		- receives `imu_integrator_seq` on `imu_integrator_seq` topic
		- receives `imu_integrator_input` on `imu_integrator_input` topic
		
- [`pose_prediction`][18]: Uses the latest IMU value to predict a pose for a future point in time.
	- Subscried Topics:
		- receives `pose_type` on `slow_pose` topic
		- receives `imu_raw` on `imu_raw` topic
		- receives `pose_type` on `true_pose` topic
		- receives `time_type` on `vsync_estimate` topic

- [`gldemo`][8]: Renders a static scene (into left and right eyebuffers) given the pose from `pose_prediction`.
	- Published Topics:
		- publishes `rendered_frame` on `eyebuffer` topic
	- Subscried Topics:
		- receives `time_type` on `vsync_estimate` topic

- [`timewarp_gl`][9]: [Asynchronous reprojection][2] of the eyebuffers.
	- Published Topics:
		- publishes `hologram_input` on `hologram_in` topic
		- publishes `time_type` on `vsync_estimate` topic
		- publishes `std::chrono::duration<double, std::nano>` on `mtp` topic
		- publishes `std::chrono::duration<double, std::nano>` on `warp_frame_age` topic
	- Subscried Topics:
		- receives `rendered_frame` on `eyebuffer` topic

- [`debugview`][10]: Renders a frame for debug information.
	- Subscried Topics:
		- receives `pose_type` on `slow_pose` topic
		- receives `imu_raw` on `imu_raw` topic

- [`audio`][11]: TODO: this. By default this is disabled, since it requires an NVIDIA GPU.
	- Published Topics:
		- TODO

- [`hologram`][12]: TODO: this. By default this is disabled, since it requires an NVIDIA GPU.
	- Published Topics:
		- TODO

Below this point, we will use Switchboard terminology. Read the [API documentation on `switchboard`][3] for definitions.

<img src="../dataflow.dot.png" alt ="ILLIXR dataflow graph generated by dataflow.dot" style="width: 400px;"/>

- In the above figure, rectangles are plugins, cylinders are topics (the graph is bipartitioned
  between these two gorups).

- Solid arrows from plugins to topics represent publishing.

- Solid arrows from topics to plugins represent synchronous reading. They take some action for
  _every_ event which gets published on the topic.

- Solid arrows from topics to plugins represent asynchronous reading. They need to know just the
  _latest_ event on their topic.

- Imagine the topic as a trough filing with events from its publisher, being drained by its
  synchronous readers (AKA subscribers), while asynchronous readres just skim from the top.

See [Writing Your Plugin][4] to extend ILLIXR.

## Other Supported Plugins
ILLIXR supports additional plugins to replace some of the default plugins.

- [`open_vins`][7]: This is an alternate SLAM ([upstream][19]) that uses a MSCKF (Multi-State Constrained Kalman Filter) to determine poses via camera/IMU.
- [`rk4_integrator`][16]: Integrates over all IMU samples since the last published SLAM pose to provide a fast-pose everytime a new IMU sample arrives using RK4 integration.

See [Building ILLIXR][4] for more information on adding plugins to a config file.

[1]: https://github.com/MIT-SPARK/Kimera-VIO
[2]: https://en.wikipedia.org/wiki/Asynchronous_reprojection
[3]: https://illixr.github.io/ILLIXR/api/html/classILLIXR_1_1switchboard.html
[4]: writing_your_plugin.md
[5]: https://github.com/ILLIXR/ILLIXR/tree/master/offline_imu_cam
[6]: https://github.com/ILLIXR/ILLIXR/tree/master/ground_truth_slam
[7]: https://github.com/ILLIXR/open_vins/
[8]: https://github.com/ILLIXR/ILLIXR/tree/master/gldemo
[9]: https://github.com/ILLIXR/ILLIXR/tree/master/timewarp_gl
[10]: https://github.com/ILLIXR/ILLIXR/tree/master/debugview
[11]: https://github.com/ILLIXR/audio_pipeline/tree/illixr-integration
[12]: https://github.com/ILLIXR/HOTlab/tree/illixr-integration
[13]: https://github.com/ILLIXR/Kimera-VIO
[14]: https://gtsam.org/
[15]: https://github.com/ILLIXR/ILLIXR/tree/master/gtsam_integrator
[16]: https://github.com/ILLIXR/ILLIXR/tree/master/rk4_integrator
[17]: building_illixr.md
[18]: https://github.com/ILLIXR/ILLIXR/tree/master/pose_prediction
[19]: https://docs.openvins.com/
